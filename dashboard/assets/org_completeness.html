<html>

<style>
.bullet {
	font: 10px sans-serif;
}

.bullet .marker {
	stroke: #000;
	stroke-width: 2px;
}

.bullet .tick line {
	stroke: #666;
	stroke-width: .5px;
}

.bullet .range.s0 {
	fill: #ddd;
}

.bullet .measure.s0 {
	fill: lightsteelblue;
}

.bullet .measure.s1 {
	fill: steelblue;
}

.bullet .measure.s2 {
	fill: orange;
}

.bullet .measure.s3 {
	fill: green;
}

.bullet .title {
	font-size: 14px;
	font-weight: bold;
}

.bullet .subtitle {
	fill: #999;
}
</style>

<head>
<title>Apixio Hive Dashboard</title>
<script src="//code.jquery.com/jquery-1.9.1.js"></script>
<script src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="mustache.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="bullet.js"></script>
<link rel="stylesheet" href="cat.css" type="text/css" />

<script>
        //------------Fetching data script---------------
            var url = "/hive/json/production/ui/group/completeness";
            
          //------------Bullet chart script-----------------------
            var margin = {top: 5, right: 40, bottom: 20, left: 120},
            width = 960 - margin.left - margin.right,
            height = 50 - margin.top - margin.bottom;

            var chart = d3.bullet()
                .width(width)
                .height(height);
           
             $.get(url).done(function( values ) {
            	 
            	 var orgHtml = "";
            	 $.each(values.orgs, function(n, data) {
            		 
            		 var org_details = "\
                         <table border='1'> \
                         <tr><th>Org Name (Org Id)</th><th>Successful archives</th><th>Successful Uploads to Pipeline</th><th>Sent To OCR</th><th>Sent To Persist</th><th>OCRed</th><th>Persisted</th><th>Verified Persistence</th><th>Pending Parser documents</th><th>Pending Persist documents</th><th>Pending OCR documents</th></tr>\
                         <tr>\
                         <td>{{org_name}} ({{org_id}})</td>\
                         <td align='center'>{{archivedToS3_count}}</td>\
                         <td align='center'>{{upload_count}}</td>\
                         <td align='center'>{{sent_to_ocr}}</td>\
                         <td align='center'>{{sent_to_persist}}</td>\
                         <td align='center'>{{ocr_count}}</td>\
                         <td align='center'>{{persist_count}}</td>\
                         <td align='center'>{{persist_verified}}</td>\
                         <td align='center'>{{parser_pending_count}}</td>\
                         <td align='center'>{{ocr_pending_count}}</td>\
                         <td align='center'>{{persist_pending_count}}</td>\
                         </tr>\
                         </table>\
                         ";
     
                         orgHtml = orgHtml + Mustache.render(org_details, data);
                         
                         var chartId = 'chart'+n;
                         orgHtml = orgHtml + "<div id='"+chartId+"'></div><br/>";
            		}); 
            	 
            	 $("#orgDetails").html(orgHtml);
            	 
            	 $.each(values.orgs, function(n, data) {
            		 var chartData = data.chart;
            			 
            		 console.log("chart:"+chartData);
            		 var chartId = 'chart'+n;
            		 
                     var svg = d3.select("#"+chartId).selectAll("svg")
                    .data(chartData)
                  .enter().append("svg")
                    .attr("class", "bullet")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(chart);
      
	               var title = svg.append("g")
	                   .style("text-anchor", "end")
	                   .attr("transform", "translate(-6," + height / 2 + ")");
	     
	               title.append("text")
	                   .attr("class", "title")
	                   .text(function(d) { return d.title; });
	     
	               title.append("text")
	                   .attr("class", "subtitle")
	                   .attr("dy", "1em")
	                   .text(function(d) { return d.subtitle; }); 
            	 });
              }); 
          //------------Fetching data script ends---------------
        </script>
</head>

<body>
	<h1>Pipeline Upload Summary</h1>
	<div id="orgDetails"></div>
</body>
</html>